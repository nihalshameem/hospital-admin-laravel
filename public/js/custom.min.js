function getUrlParams(dParam) {
    var dPageURL = window.location.search.substring(1),
        dURLVariables = dPageURL.split("&"),
        dParameterName,
        i;

    for (i = 0; i < dURLVariables.length; i++) {
        dParameterName = dURLVariables[i].split("=");

        if (dParameterName[0] === dParam) {
            return dParameterName[1] === undefined
                ? true
                : decodeURIComponent(dParameterName[1]);
        }
    }
}

function assignedDoctor() {
    if (jQuery(".assigned-doctor").length > 0) {
        /*  testimonial one function by = owl.carousel.js */
        jQuery(".assigned-doctor").owlCarousel({
            loop: false,
            margin: 30,
            nav: true,
            autoplaySpeed: 3000,
            navSpeed: 3000,
            paginationSpeed: 3000,
            slideSpeed: 3000,
            smartSpeed: 3000,
            autoplay: false,
            dots: false,
            navText: [
                '<i class="fa fa-caret-left"></i>',
                '<i class="fa fa-caret-right"></i>',
            ],
            responsive: {
                0: {
                    items: 1,
                },
                576: {
                    items: 2,
                },
                767: {
                    items: 3,
                },
                991: {
                    items: 2,
                },
                1200: {
                    items: 3,
                },
                1600: {
                    items: 5,
                },
            },
        });
    }
}

function assignedDoctor2() {
    if (jQuery(".assigned-doctor2").length > 0) {
        /*  testimonial one function by = owl.carousel.js */
        jQuery(".assigned-doctor2").owlCarousel({
            loop: false,
            margin: 30,
            nav: true,
            autoplaySpeed: 3000,
            navSpeed: 3000,
            paginationSpeed: 3000,
            slideSpeed: 3000,
            smartSpeed: 3000,
            autoplay: false,
            dots: false,
            navText: [
                '<i class="fa fa-caret-left"></i>',
                '<i class="fa fa-caret-right"></i>',
            ],
            responsive: {
                0: {
                    items: 1,
                },

                480: {
                    items: 1,
                },

                991: {
                    items: 2,
                },
                1680: {
                    items: 2,
                },
            },
        });
    }
}

function pieChart() {
    if (jQuery("#pie-chart").length > 0) {
        var data = {
            labels: ["35%", "55%", "10%"],
            series: [30, 25, 15],
        };

        var options = {
            labelInterpolationFnc: function (value) {
                return value[0];
            },
        };

        var responsiveOptions = [
            [
                "screen and (min-width: 230px)",
                {
                    chartPadding: 10,
                    donut: true,
                    labelOffset: 40,
                    donutWidth: 50,
                    labelDirection: "explode",
                    labelInterpolationFnc: function (value) {
                        return value;
                    },
                },
            ],
            [
                "screen and (min-width: 230px)",
                {
                    labelOffset: 60,
                    chartPadding: 20,
                },
            ],
        ];

        new Chartist.Pie("#pie-chart", data, options, responsiveOptions);
    }
}

(function ($) {
    /* "use strict" */
    var eres = (function () {
        var screenWidth = $(window).width();

        var checkboxSelectAll = function () {
            $("#checkAll").change(function () {
                $("td input:checkbox").prop("checked", $(this).prop("checked"));
            });
        };

        $("#patient-table").on("click", ".editModalBtn", function () {
            let row_id = $(this).data("id");
            $("#form_select").attr("data-id", row_id);
            $("#editModal").modal("show");
        });

        $("#selected-edit").on("click", function () {
            let v = $("#form_select").val();
            let id = $("#form_select").attr("data-id");
            let url = window.location.href.split("?")[0].split("#")[0];
            window.location.href = url + v + id;
        });

        $("#patient-selecter").on("click", function () {
            let id = $("#patient_id_select").val();
            let link = $("#patient_id_select").data("link");
            window.location.href = link + "/" + id;
        });

        var handleToggleMenu = function () {
            $(".nav-control").on("click", function () {
                $("#main-wrapper").toggleClass("menu-toggle");

                $(".hamburger").toggleClass("is-active");
            });
        };

        var handlePageActive = function () {
            //to keep the current page active

            for (
                var nk = window.location,
                    o = $("ul#menu a")
                        .filter(function () {
                            return this.href == nk;
                        })
                        .addClass("mm-active")
                        .parent()
                        .addClass("mm-active");
                ;

            ) {
                // console.log(o)
                if (!o.is("li")) break;
                o = o
                    .parent()
                    .addClass("mm-show")
                    .parent()
                    .addClass("mm-active");
            }
        };

        var dzSidebarStyle = function () {
            $("ul#menu>li").on("click", function () {
                const sidebarStyle = $("body").attr("data-sidebar-style");
                if (sidebarStyle === "mini") {
                    console.log($(this).find("ul"));
                    $(this).find("ul").stop();
                }
            });
        };

        var contentBodyHeight = function () {
            var win_h = window.outerHeight;
            var win_h = window.outerHeight;
            if (win_h > 0 ? win_h : screen.height) {
                $(".content-body").css("min-height", win_h + 60 + "px");
            }
        };

        var cardCollapse = function () {
            $('a[data-action="collapse"]').on("click", function (i) {
                i.preventDefault(),
                    $(this)
                        .closest(".card")
                        .find('[data-action="collapse"] i')
                        .toggleClass("mdi-arrow-down mdi-arrow-up"),
                    $(this)
                        .closest(".card")
                        .children(".card-body")
                        .collapse("toggle");
            });

            $('a[data-action="expand"]').on("click", function (i) {
                i.preventDefault(),
                    $(this)
                        .closest(".card")
                        .find('[data-action="expand"] i')
                        .toggleClass("icon-size-actual icon-size-fullscreen"),
                    $(this).closest(".card").toggleClass("card-fullscreen");
            });
        };

        var cardLoader = function () {
            $('[data-action="close"]').on("click", function () {
                $(this).closest(".card").removeClass().slideUp("fast");
            });

            $('[data-action="reload"]').on("click", function () {
                var e = $(this);
                e.parents(".card").addClass("card-load"),
                    e
                        .parents(".card")
                        .append(
                            '<div class="card-loader"><i class=" ti-reload rotate-refresh"></div>'
                        ),
                    setTimeout(function () {
                        e.parents(".card").children(".card-loader").remove(),
                            e.parents(".card").removeClass("card-load");
                    }, 2000);
            });
        };

        var dzScrollBar = function () {
            jQuery(".dz-scroll").each(function () {
                var scroolWidgetId = jQuery(this).attr("id");
                const ps = new PerfectScrollbar("#" + scroolWidgetId, {
                    wheelSpeed: 2,
                    wheelPropagation: true,
                    minScrollbarLength: 20,
                });
            });
        };

        var handleBodyLayout = function () {
            const headerHight = $(".header").innerHeight();

            $(window).scroll(function () {
                if (
                    $("body").attr("data-layout") === "horizontal" &&
                    $("body").attr("data-header-position") === "static" &&
                    $("body").attr("data-sidebar-position") === "fixed"
                )
                    $(this.window).scrollTop() >= headerHight
                        ? $(".deznav").addClass("fixed")
                        : $(".deznav").removeClass("fixed");
            });
        };

        var metisMenuSidebar = function () {
            jQuery(".metismenu > .mm-active ").each(function () {
                if (!jQuery(this).children("ul").length > 0) {
                    jQuery(this).addClass("active-no-child");
                }
            });
        };

        var dzAjex = function () {
            jQuery(".bell-link").on("click", function () {
                jQuery(".chatbox").addClass("active");
            });
            jQuery(".chatbox-close").on("click", function () {
                jQuery(".chatbox").removeClass("active");
            });

            jQuery(".dz-chat-user-box .dz-chat-user").on("click", function () {
                jQuery(".dz-chat-user-box").addClass("d-none");
                jQuery(".dz-chat-history-box").removeClass("d-none");
            });

            jQuery(".dz-chat-history-back").on("click", function () {
                jQuery(".dz-chat-user-box").removeClass("d-none");
                jQuery(".dz-chat-history-box").addClass("d-none");
            });

            jQuery(".dz-fullscreen").on("click", function () {
                jQuery(".dz-fullscreen").toggleClass("active");
            });
        };
        var btnNumber = function () {
            $(".btn-number").on("click", function (e) {
                e.preventDefault();

                fieldName = $(this).attr("data-field");
                type = $(this).attr("data-type");
                var input = $("input[name='" + fieldName + "']");
                var currentVal = parseInt(input.val());
                if (!isNaN(currentVal)) {
                    if (type == "minus") input.val(currentVal - 1);
                    else if (type == "plus") input.val(currentVal + 1);
                } else {
                    input.val(0);
                }
            });
        };

        var dzFullScreen = function () {
            jQuery(".dz-fullscreen").on("click", function (e) {
                if (
                    document.fullscreenElement ||
                    document.webkitFullscreenElement ||
                    document.mozFullScreenElement ||
                    document.msFullscreenElement
                ) {
                    /* Enter fullscreen */

                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen(); /* IE/Edge */
                    } else if (document.mozCancelFullScreen) {
                        document.mozCancelFullScreen(); /* Firefox */
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen(); /* Chrome, Safari & Opera */
                    }
                } else {
                    /* exit fullscreen */
                    if (document.documentElement.requestFullscreen) {
                        document.documentElement.requestFullscreen();
                    } else if (
                        document.documentElement.webkitRequestFullscreen
                    ) {
                        document.documentElement.webkitRequestFullscreen();
                    } else if (document.documentElement.mozRequestFullScreen) {
                        document.documentElement.mozRequestFullScreen();
                    } else if (document.documentElement.msRequestFullscreen) {
                        document.documentElement.msRequestFullscreen();
                    }
                }
            });
        };

        /* Function ============ */
        return {
            init: function () {
                checkboxSelectAll();
                handleToggleMenu();
                handlePageActive();
                dzSidebarStyle();
                contentBodyHeight();
                cardCollapse();
                cardLoader();
                handleBodyLayout();
                dzScrollBar();
                metisMenuSidebar();
                dzAjex();
                btnNumber();
                dzFullScreen();
            },

            load: function () {},

            resize: function () {},
        };
    })();

    jQuery(document).ready(function () {
        $("#menu").metisMenu();

        const qs = new PerfectScrollbar(".deznav-scroll");

        // var mother_weight = document.querySelector('#mother_weight');

        // mother_weight.addEventListener('input', restrictNumber);

        // var pw_height = document.querySelector('#pw_height');

        // pw_height.addEventListener('input', restrictNumber);

        // function restrictNumber (e) {
        //     var newValue = this.value.replace(new RegExp(/[^\d]/,'ig'), "");
        //     this.value = newValue;
        // }

        eres.init();
        if (jQuery("#example-5").length > 0) {
            var table = $("#example-5").DataTable({
                searching: false,
                paging: true,
                select: false,
                //info: false,
                lengthChange: false,
            });
        }
        if (jQuery("#patient-table").length > 0) {
            var table = $("#patient-table").DataTable({
                searching: false,
                paging: true,
                select: false,
                //info: false,
                lengthChange: false,
                processing: true,
                serverSide: true,
                ajax: window.location.href,
                columns: [
                    {
                        data: "checkbox",
                        name: "checkbox",
                    },
                    {
                        data: "id",
                        name: "id",
                    },
                    {
                        data: "hsc_name",
                        name: "hsc_name",
                    },
                    {
                        data: "rch_id",
                        name: "rch_id",
                    },
                    {
                        data: "an_mother",
                        name: "an_mother",
                    },
                    {
                        data: "husband_name",
                        name: "husband_name",
                    },
                    {
                        data: "an_reg_date",
                        name: "an_reg_date",
                    },
                    {
                        data: "edit",
                        name: "edit",
                        orderable: false,
                        searchable: false,
                    },
                    {
                        data: "delete",
                        name: "delete",
                        orderable: false,
                        searchable: false,
                    },
                ],
            });
        }
        if (jQuery("#mother-visit-all-table").length > 0) {
            var table = $("#mother-visit-all-table").DataTable({
                searching: false,
                paging: true,
                select: false,
                //info: false,
                lengthChange: false,
                processing: true,
                serverSide: true,
                ajax: window.location.href,
                columns: [
                    {
                        data: "checkbox",
                        name: "checkbox",
                    },
                    {
                        data: "rch_id",
                        name: "rch_id",
                    },
                    {
                        data: "hsc_name",
                        name: "hsc_name",
                    },
                    {
                        data: "an_mother",
                        name: "an_mother",
                    },
                    {
                        data: "husband_name",
                        name: "husband_name",
                    },
                    {
                        data: "mobile",
                        name: "mobile",
                    },
                    {
                        data: "an_reg_date",
                        name: "an_reg_date",
                    },
                    {
                        data: "edit",
                        name: "edit",
                        orderable: false,
                        searchable: false,
                    },
                ],
            });
        }
        if (jQuery("#mother-medical-table").length > 0) {
            var table = $("#mother-medical-table").DataTable({
                searching: false,
                paging: true,
                select: false,
                //info: false,
                lengthChange: false,
                processing: true,
                serverSide: true,
                ajax: window.location.href,
                columns: [
                    {
                        data: "checkbox",
                        name: "checkbox",
                    },
                    {
                        data: "patient_id",
                        name: "patient_id",
                    },
                    {
                        data: "pw_rch_reg_number",
                        name: "pw_rch_reg_number",
                    },
                    {
                        data: "financial_year",
                        name: "financial_year",
                    },
                    {
                        data: "mother_name",
                        name: "mother_name",
                    },
                    {
                        data: "eligible_for_mrmbs",
                        name: "eligible_for_mrmbs",
                    },
                    {
                        data: "an_reg_date",
                        name: "an_reg_date",
                    },
                    {
                        data: "edit",
                        name: "edit",
                        orderable: false,
                        searchable: false,
                    },
                    {
                        data: "delete",
                        name: "delete",
                        orderable: false,
                        searchable: false,
                    },
                ],
            });
        }
        if (jQuery("#mother-visit-table").length > 0) {
            var table = $("#mother-visit-table").DataTable({
                searching: false,
                paging: true,
                select: false,
                //info: false,
                lengthChange: false,
                processing: true,
                serverSide: true,
                ajax: window.location.href,
                columns: [
                    {
                        data: "checkbox",
                        name: "checkbox",
                    },
                    {
                        data: "patient_id",
                        name: "patient_id",
                    },
                    {
                        data: "visit_type",
                        name: "visit_type",
                    },
                    {
                        data: "an_visit_mother_name",
                        name: "an_visit_mother_name",
                    },
                    {
                        data: "financial_year",
                        name: "financial_year",
                    },
                    {
                        data: "remark",
                        name: "remark",
                    },
                    {
                        data: "result",
                        name: "result",
                        orderable: false,
                        searchable: false,
                    },
                    {
                        data: "edit",
                        name: "edit",
                        orderable: false,
                        searchable: false,
                    },
                    {
                        data: "delete",
                        name: "delete",
                        orderable: false,
                        searchable: false,
                    },
                ],
            });
        }
        if (jQuery("#example").length > 0) {
            $("#example tbody").on("click", "tr", function () {
                var data = table.row(this).data();
            });
        }
        if (jQuery(".donut").length > 0) {
            $("span.donut").peity("donut", {
                width: "180",
                height: "180",
            });
        }
        if (jQuery("#lightgallery").length > 0) {
            $("#lightgallery").lightGallery({
                loop: true,
                thumbnail: true,
                exThumbImage: "data-exthumbimage",
            });
        }

        $(function () {
            $('[data-toggle="popover"]').popover();
        });
        // $(function () {
        //     $('[data-id="hsc_id"]').attr("disabled", true);
        // });

        $("#mother_blood").change(function () {
            if ($(this).val() == "Done") {
                $("#blood_grp").attr("disabled", "false");
                $('[data-id="blood_grp"]').attr("disabled", false);
            } else {
                $("#blood_grp").attr("disabled", "true");
                $('[data-id="blood_grp"]').attr("disabled", true);
            }
        });

        $("#is_vdrl_rpp").change(function () {
            if ($(this).val() == "yes") {
                $("#vdrl_result").attr("disabled", "false");
                $('[data-id="vdrl_result"]').attr("disabled", false);
                $("#vdrl_date").attr("disabled", "false");
            } else {
                $("#vdrl_result").attr("disabled", "true");
                $('[data-id="vdrl_result"]').attr("disabled", true);
                $("#vdrl_date").attr("disabled", "true");
            }
        });

        // $(function() {
        //     $('input:radio[name="hbsag_done"]').change(function() {
        //         if ($(this).val() == 'yes') {
        //             $('input:radio[name="hbsag_status"]').attr("disabled", false);
        //             $('input:radio[name="hbsag_status"]').attr("checked", false);
        //         } else {
        //             $('input:radio[name="hbsag_status"]').attr("checked", false);
        //             $('input:radio[name="hbsag_status"]').attr("disabled", true);
        //         }
        //     });
        // });

        $(function () {
            $('select[name="last_complication_id"]').change(function () {
                if ($(this).val() == 12) {
                    $('input:text[name="last_other_complication"]').show();
                } else {
                    $('input:text[name="last_other_complication"]').hide();
                }
            });
        });

        $(function () {
            $('select[name="present_complication_id"]').change(function () {
                if ($(this).val() == 12) {
                    $('input:text[name="present_other_complication"]').show();
                } else {
                    $('input:text[name="present_other_complication"]').hide();
                }
            });
        });

        $("#wife_hiv_screening").change(function () {
            console.log($(this).val());
            if ($(this).val() == "yes") $("#wife_hiv_screening_div").show();
            else $("#wife_hiv_screening_div").hide();
        });

        $("#husband_hiv_screening").change(function () {
            console.log($(this).val());
            if ($(this).val() == "yes") $("#husband_hiv_screening_div").show();
            else $("#husband_hiv_screening_div").hide();
        });

        $(document).ready(function () {
            console.log($("#wife_hiv_screening").val());
            if ($("#wife_hiv_screening").val() == "yes")
                $("#wife_hiv_screening_div").show();
            else $("#wife_hiv_screening_div").hide();
        });

        $(document).ready(function () {
            console.log($("#husband_hiv_screening").val());
            if ($("#husband_hiv_screening").val() == "yes")
                $("#husband_hiv_screening_div").show();
            else $("#husband_hiv_screening_div").hide();
        });

        function vdrl_check() {
            if ($("#is_vdrl_rpp").val() == "yes") $("#vdrl_div").show();
            else $("#vdrl_div").hide();
        }
        vdrl_check();

        $("#is_vdrl_rpp").change(function () {
            vdrl_check();
        });

        $("#abortion_if_any").change(function () {
            if ($(this).val() == "yes") {
                console.log($(this).val());
                $("#week_preg_div").show();

                $("#ab_date_div").show();
                $("#dist_faci_div").show();
                $("#week_preg_inp_div").show();
                $("#noAbortion").hide();
            } else {
                $("#week_preg_div").hide();
                $("#ab_date_div").hide();
                $("#dist_faci_div").hide();
                $("#week_preg_inp_div").hide();
                $("#noAbortion").show();
            }
        });

        $("#abortion_type").change(function () {
            if ($(this).val() == "Induced") {
                $("#dist_faci_div").show();
            } else {
                $("#dist_faci_div").hide();
            }
        });

        $("#urine_test").change(function () {
            if ($(this).val() == "Done") {
                $("#urine_sugar_div").show();
                $("#urine_albumin_div").show();
            } else {
                $("#urine_sugar_div").hide();
                $("#urine_albumin_div").hide();
            }
        });

        $("#blood_sugar_test").change(function () {
            if ($(this).val() == "Done") {
                $("#fasting_div").show();
                $("#post_prandial_div").show();
            } else {
                $("#fasting_div").hide();
                $("#post_prandial_div").hide();
            }
        });

        $("#gct").change(function () {
            if ($(this).val() == "Done") {
                $("#gct_value_div").show();
            } else {
                $("#gct_value_div").hide();
            }
        });

        $("#ultrasonogram").change(function () {
            if ($(this).val() == "Yes") {
                $("#ultrasonogram_date_div").show();
                $("#ultrasonogram_div").show();
            } else {
                $("#ultrasonogram_date_div").hide();
                $("#ultrasonogram_div").hide();
            }
        });
    });

    jQuery(window).on("load", function () {
        $("#preloader").fadeOut(500);
        $("#main-wrapper").addClass("show");

        $("select").selectpicker();

        eres.load();

        setTimeout(function () {
            assignedDoctor();
            assignedDoctor2();
            pieChart();
        }, 1000);
    });

    jQuery(window).on("resize", function () {
        eres.resize();
    });
})(jQuery);
